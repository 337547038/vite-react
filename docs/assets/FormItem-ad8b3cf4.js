import{r as u,j as s,c as q,p as d}from"./index-eab8b3d4.js";import{I as Z}from"./Input-0782e8bd.js";import{R as D}from"./RadioGroup-be5fe1f1.js";import{a as G}from"./Group-a3f6de10.js";import{S as H}from"./Option-3f9b748b.js";import{S as W}from"./Switch-e6494f69.js";import{T as O}from"./Textarea-a0f5ac41.js";import{D as _}from"./DatePicker-4eb42b7b.js";import{F as v,a as B}from"./contextForm-cfeffa56.js";import{d as J}from"./index-a427ff8b.js";const E=u.forwardRef((e,o)=>{var h;let n=s.jsx("div",{});const t=e.defaultValue||((h=e.data)==null?void 0:h.defaultValue),r=u.useRef(t),l=x=>{r.current=x,e.onChange&&e.onChange(x)};switch(e.type){case"radio":n=s.jsx(D,{...e.data,defaultValue:t,onChange:l});break;case"checkbox":n=s.jsx(G,{...e.data,defaultValue:t,onChange:l});break;case"select":n=s.jsx(H,{...e.data,defaultValue:t,onChange:l});break;case"switch":n=s.jsx(W,{...e.data,defaultValue:t,onChange:l});break;case"textarea":n=s.jsx(O,{...e.data,defaultValue:t,onChange:l});break;case"datePicker":n=s.jsx(_,{...e.data,defaultValue:t,onChange:l});break;default:n=s.jsx(Z,{...e.data,defaultValue:t,onChange:l})}const y=()=>r.current;return u.useImperativeHandle(o,()=>({getValue:y})),n});E.displayName="Field";const $={digits:/^[0-9]*[1-9][0-9]*$/,number:/^\d+(\.\d+)?$/,mobile:/^1[3|4|5|7|8]\d{9}$/,mail:/^[a-z0-9A-Z._%-]+@([a-z0-9A-Z-]+\.)+[a-zA-Z]{2,4}$/,tel:/^0\d{2,3}-\d{7,8}$/,fax:/^(\d{3,4})?[-]?\d{7,8}$/};function N(e){const o=Function;return new o("return "+e)()}const g=function(e){return/^\s*$/g.test(e)},k=function(e,o,n){return n==="rule"?N(o).test(e):$[o]===void 0?"undefined":N($[o]).test(e)},K=function(e,o){for(let n=0,t=o.length;n<t;n++){const r=o[n];switch(r.type){case"required":if(g(e)||e===!1||e===void 0)return r.msg;break;case"digits":case"number":case"mobile":case"mail":case"tel":case"fax":if(!g(e)&&!k(e,r.type))return r.msg;break;case"phone":if(!g(e)&&!(k(e,"mobile")||k(e,"tel")))return r.msg;break;case"maxLength":if(!g(e)&&parseInt(e.length,10)>parseInt(r.len,10))return r.msg;break;case"minLength":if(!g(e)&&parseInt(e.length,10)<parseInt(r.len,10))return r.msg;break;case"rule":if(!g(e)&&!k(e,r.rule,"rule"))return r.msg;break;case"fn":if(!r.validator(e))return r.msg;break}}return!0},S=u.forwardRef((e,o)=>{const n=u.useRef(),t=u.useContext(v),r=(i,m)=>{const a=e[i];return a===m&&Object.keys(t).length>0?t[i]:a},l=r("size",void 0),y=r("labelWidth",void 0),h=r("trigger","change"),x=r("showMessage",!0),[f,V]=u.useState({msg:"",icon:""}),T={display:e.labelVisible?"none":"",width:y},C=[];if(e.verify){const i={required:"必填字段",mobile:"手机号格式不正确",tel:"电话号码不正确",mail:"请输入正确邮箱",digits:"必须为正整数",number:"必须为数字",phone:"请输入固话或手机"};e.verify.split(",").forEach(a=>{C.push({type:a,msg:i[a]})})}let c=(e.rules||[]).concat(C);(c==null?void 0:c.length)===0&&e.prop&&(t!=null&&t.rules)&&(c=t.rules[e.prop]||[]);const P=(()=>{let i=!1;return r("required",!0)&&(c==null?void 0:c.length)>0&&c.forEach(a=>{if(a.type==="required")return i=!0,!1}),i})(),j=i=>{const m=i===void 0?n.current:i;let a={msg:"",icon:""};return new Promise((b,R)=>{if(e.error)R(e.error);else if(c.length>0){const w=K(m,c);w===!0?(a={msg:"",icon:"icon-success"},b(!0)):(a={msg:w,icon:"icon-failure"},R(w))}else b(!0),console.log("没有校验规则通过"+e.prop);V(a)})},I=()=>n.current,F=()=>{V({icon:"",msg:""})};u.useImperativeHandle(o,()=>({getValue:I,clearTips:F,validate:j}));const z=J(()=>{e.prop&&t.callback&&t.callback({validate:j,clearTips:F,getValue:I,prop:e.prop||""})});u.useEffect(()=>{z()},[]);const L={disabled:t.disabled,controlChange:(i,m)=>{if(n.current=i,m!=="default")if(m==="focus"){let a="";c.forEach(b=>{b.type==="tips"&&(a=b.msg)}),a&&!i&&V({msg:a,icon:"icon-tips"})}else m==="blur"?h&&j(i).catch(a=>{console.log(a)}):m==="change"&&(h==="change"&&j(i).catch(a=>{console.log(a)}),e.onChange&&e.onChange(i),t.onChange&&t.onChange(i,e.prop||""))}},M=s.jsx("label",{className:q({required:P,[d+"-form-label"]:!0}),style:T,children:e.label});return s.jsx(B.Provider,{value:L,children:s.jsxs("div",{className:q(e.className,{[d+"-form-item-error"]:f.msg!=="",[d+"-form-item"]:!0,["form-item-"+l]:l}),children:[e.label?M:"",s.jsxs("div",{className:`${d}-form-box`,children:[e.type?s.jsx(E,{type:e.type,data:e.data,defaultValue:e.defaultValue}):"",e.children,s.jsx(s.Fragment,{children:f.icon&&x&&((c==null?void 0:c.length)>0||e.error)?f.msg?s.jsxs("div",{className:`${d}-form-tips`,children:[s.jsx("i",{className:f.icon}),s.jsx("span",{children:f.msg})]}):s.jsx("div",{className:`${d}-form-tips ${f.icon}`}):""})]}),e.other]})})});S.displayName="FormItem";S.defaultProps={required:!0,showMessage:!0,trigger:"change",rules:[]};export{S as F,E as a};
