var j=Object.defineProperty,q=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var I=(e,i,l)=>i in e?j(e,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[i]=l,N=(e,i)=>{for(var l in i||(i={}))G.call(i,l)&&I(e,l,i[l]);if(T)for(var l of T(i))J.call(i,l)&&I(e,l,i[l]);return e},k=(e,i)=>q(e,z(i));import{r as o,a as g,j as M,R as Q}from"./index.47748ac2.js";import{c as W}from"./index.926ca9c5.js";import{a as X,p as Y}from"./contextForm.e60719b8.js";import{S as Z}from"./SelectDown.9879e93a.js";import{d as w,o as C}from"./index.4eedf3c9.js";const D=o.exports.forwardRef((e,i)=>{const{optionsKey:l={label:"label",value:"value"}}=e,[f,m]=o.exports.useState([]),[r,h]=o.exports.useState([]),[s,V]=o.exports.useState(e.options||[]),[S,O]=o.exports.useState([]),b=o.exports.useRef(""),x=o.exports.useRef(null),E=o.exports.useContext(X);o.exports.useEffect(()=>{p(),V([...e.options||[]])},[e.defaultValue,e.options]),o.exports.useEffect(()=>{R()},[e.children]);const R=w(()=>{const t=[],a=e.children;a&&typeof a=="object"&&(a.forEach(n=>{Q.isValidElement(n)&&typeof n.type=="function"&&n.type.name==="Options"&&t.push(n.props)}),V([...s,...t]))}),p=w(()=>{const t=e.multiple?e.defaultValue||[]:e.defaultValue||"";if((t==null?void 0:t.length)>0&&(s==null?void 0:s.length)>0){let a=[];e.multiple?a=[...e.defaultValue]:a=[e.defaultValue];for(let n=0;n<s.length;n++){const u=s[n][l.value],c=s[n][l.label];if(e.multiple){if(typeof t=="object"){const d=t.indexOf(u);d!==-1&&a.splice(d,1,c)}}else if(u===t){a[0]=c;break}}h([...a])}m(typeof t=="object"?[...t]:[t])},10),B=t=>{const a=t[l.value];return f.includes(a)},L=()=>{var t;(t=x.current)==null||t.slideUp()},H=(t,a)=>{if(!t.disabled){if(e.beforeChange&&!e.beforeChange(t)){L(),a.stopPropagation();return}const n=t[l.value],u=t[l.label];let c=[];if(e.multiple){if(e.multipleLimit&&e.multipleLimit>0&&e.multipleLimit<=r.length)return e.limitChange&&e.limitChange(),!1;let d=[],v=[];f.includes(n)?(d=C(f,[n]),v=C(r,[u])):(d=[...f,n],v=[...r,u]),m(d),h(v),c=d}else L(),m([t[l.value]]),h([t[l.label]]),c=t[l.value];e.onChange&&e.onChange(c),E.controlChange&&E.controlChange(c,"change")}a.stopPropagation()},P=(t,a,n)=>{!e.filterable||(b.current=t,e.onBlur&&e.onBlur(t,a,n))},F=t=>{if(!t&&e.filterable&&b.current){let a=!1;for(let n=0;n<s.length;n++){const u=s[n][l.label],c=s[n][l.value];if(b.current===u){e.multiple?(h([...r,u]),m([...f,c]),y()):(h([u]),m([c])),a=!0;break}}a||(e.multiple?y():h([...r])),O([])}},K=(t,a,n)=>{if(!e.async){const u=[];s.forEach(c=>{c[l.label].indexOf(t)===-1&&u.push(c[l.value])}),O([...u])}e.onInput&&e.onInput(t,a,n)},U=t=>{!e.multiple||(f.splice(t,1),r.splice(t,1),m([...f]),h([...r]),e.onDelete&&e.onDelete(t))},A=()=>e.multiple?f:f[0],y=()=>{var t;(t=x.current)==null||t.clearValue()};o.exports.useImperativeHandle(i,()=>({getValue:A,clearValue:y}));const $=C(e,["options","multipleLimit","optionsKey","beforeChange","async","emptyText"]);return g(Z,k(N({},$),{defaultValue:r,onBlur:P,onInput:K,onDelete:U,toggleClick:F,ref:x,children:M("ul",{className:`${Y}-select`,children:[s.map((t,a)=>g("li",{className:W({disabled:t.disabled,[t.class]:t.class,active:B(t)}),title:t[l.label],onClick:H.bind(globalThis,t),style:{display:S.includes(t[l.value])?"none":""},children:t[l.label]},a)),s.length===0||s.length===S.length?g("li",{className:"select-empty-options",children:e.emptyText||"\u6682\u65E0\u6570\u636E"}):""]})}))});D.displayName="Select";D.propTypes={};const _=e=>g("div",{});_.displayName="Options";export{_ as O,D as S};
