var K=Object.defineProperty;var W=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var A=(e,o,c)=>o in e?K(e,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[o]=c,h=(e,o)=>{for(var c in o||(o={}))Q.call(o,c)&&A(e,c,o[c]);if(W)for(var c of W(o))Z.call(o,c)&&A(e,c,o[c]);return e};import{r as s,j as r,a as i,F as _,b as ee}from"./index.47748ac2.js";import{c as m}from"./index.926ca9c5.js";import{a as te,p as R}from"./contextForm.e60719b8.js";import{T as ne}from"./Tag.9f851e44.js";const le=e=>{const o=e.getBoundingClientRect(),c=o.top+(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0),t=o.left+(window.pageXOffset||document.documentElement.scrollLeft)-(document.documentElement.clientLeft||0),d=e.offsetWidth,g=e.offsetHeight;return{left:t,top:c,width:d,height:g}},oe=()=>{const e=document.documentElement.clientWidth||document.body.clientWidth,o=document.documentElement.clientHeight||document.body.clientHeight;return{width:e,height:o}},L=s.exports.forwardRef((e,o)=>{const{defaultValue:c=[]}=e,[t,d]=s.exports.useState(c),[g,F]=s.exports.useState(e.direction||0),[x,B]=s.exports.useState(Object.assign({},e.downStyle,{display:"none"})),u=s.exports.useContext(te).disabled||e.disabled,p=s.exports.useRef(null),I=s.exports.useRef(null);s.exports.useEffect(()=>{d([...c])},[e.defaultValue]);let O={};e.downHeight&&(O={maxHeight:e.downHeight+"px",overflowY:"auto"});const S=s.exports.useRef(!1),f=s.exports.useRef(!1),Y=n=>{u||(j(n),z(!0),S.current=!0,f.current=!0,e.toggleClick&&e.toggleClick(!0,n),setTimeout(()=>{S.current=!1},100))},j=n=>{var l;if(e.direction===0){F(e.direction);const a=document.documentElement.clientHeight||document.body.clientHeight,H=n.clientY;let N=e.downHeight||((l=I.current)==null?void 0:l.offsetHeight)||0;N>a-H&&H>N&&F(2)}},z=n=>{if(!p.current)return;let l={};const a=le(p.current);if(e.appendToBody){const N=oe();l={bottom:"auto",minWidth:a.width+"px",left:a.left+"px",top:a.top+a.height+8+"px"},g===2&&(l.top="auto",l.bottom=N.height-a.top+"px")}else l.top=a.height+8+"px",l.bottom="auto",g===2&&(l.bottom=a.height+8+"px",l.top="auto");const H={display:n?"":"none"};B(h(h(h({},x),l),H))},M=n=>{f.current&&!e.filterable&&(b(n),n.stopPropagation())},b=n=>{if(f.current&&!S.current){n&&e.toggleClick&&e.toggleClick(!1,n);const l={display:"none"};B(h(h({},x),l)),f.current=!1}},C=(n,l)=>{let a=l.target.value;n==="normal"&&d([a]),n==="start"&&(t[0]=a,d([...t])),n==="end"&&(t[1]=a,d([...t])),k(l,"onInput")},y=n=>{k(n,"onFocus")},T=n=>{k(n,"onBlur")},k=(n,l)=>{if(e.filterable){let a=n.target.value;e[l]&&e[l](a,t,n)}},D=(n,l)=>{t.splice(n,1),d([...t]),e.onDelete&&e.onDelete(n),l.stopPropagation()},$=n=>{d([]),v(),e.onInput&&e.onInput("",[]),n.stopPropagation()},U=n=>{n.stopPropagation()};s.exports.useEffect(()=>(document.addEventListener("click",b,!1),()=>{document.removeEventListener("click",b,!1)}),[x]);const X=()=>t,w=s.exports.useRef(null),E=s.exports.useRef(null),v=()=>{e.filterable&&(w.current&&(w.current.value=""),E.current&&(E.current.value=""))};s.exports.useImperativeHandle(o,()=>({getValue:X,clearValue:v,slideUp:b}));const P={[`${R}-input-control`]:!0,[e.size]:e.size,disabled:u},q=r("div",{className:m("select-range",P),children:[i("input",{ref:w,value:t[0],readOnly:!e.filterable,placeholder:e.placeholder,disabled:u,onChange:C.bind(globalThis,"start"),onFocus:y,onBlur:T},"start"),i("span",{children:e.rangeSeparator}),i("input",{ref:E,value:t[1],readOnly:!e.filterable,placeholder:e.endPlaceholder,disabled:u,onChange:C.bind(globalThis,"end"),onFocus:y,onBlur:T},"end")]}),G=i("div",{className:m("multiple-text",P),children:r("ul",{placeholder:e.placeholder,children:[e.collapseTags?r(s.exports.Fragment,{children:[(t==null?void 0:t.length)>0?r("li",{children:[i("span",{children:t[0]}),i("i",{className:"icon-error",onClick:D.bind(globalThis,0)})]}):"",(t==null?void 0:t.length)>1?i("li",{children:r(ne,{size:"mini",type:"info",children:[" +",t==null?void 0:t.length]})}):""]}):i(_,{children:t.map((n,l)=>r("li",{children:[i("span",{children:n}),i("i",{className:"icon-error",onClick:D.bind(globalThis,l)})]},n))}),e.filterable?i("li",{className:"input",children:i("input",{ref:w,type:"text",disabled:u,placeholder:(t==null?void 0:t.length)===0?e.placeholder:"",onChange:C.bind(globalThis,"multiple"),onFocus:y,onBlur:T})}):""]})}),J=i("input",{ref:w,value:(t==null?void 0:t.length)>0?t[0]:"",readOnly:!e.filterable,placeholder:e.placeholder,className:m(P),disabled:u,onChange:C.bind(globalThis,"normal"),onFocus:y,onBlur:T}),V=r("div",{ref:I,className:m(e.className,{[R+"-select-down-pane"]:!0,[e.downClass]:e.downClass,top:g===2}),style:x,onClick:U,children:[i("div",{style:O,className:"scroll-pane",children:e.children}),i("span",{className:m("down-arrow",{"is-range":e.isRange})})]});return r("div",{ref:p,className:m({"is-down":f.current,[R+"-select-down"]:!0,disabled:u}),onClick:Y,style:{width:e.width},children:[r("div",{className:"select-control",onClick:M,children:[e.isRange?q:e.multiple?G:J,r("span",{className:"group-icon",children:[e.clear&&(t==null?void 0:t.length)>0?i("i",{className:"icon-close",title:"\u6E05\u7A7A",onClick:$}):"",i("i",{className:m({down:f.current&&!e.fixedIcon,[`icon-${e.icon}`]:!0})})]})]}),e.appendToBody?ee.createPortal(V,document.body):V]})});L.displayName="SelectDown";L.defaultProps={icon:"arrow",rangeSeparator:"To",direction:0,downHeight:0,appendToBody:!1};export{L as S};
