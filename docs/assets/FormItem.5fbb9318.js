var G=Object.defineProperty,H=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var A=(e,r,t)=>r in e?G(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,f=(e,r)=>{for(var t in r||(r={}))O.call(r,t)&&A(e,t,r[t]);if(N)for(var t of N(r))_.call(r,t)&&A(e,t,r[t]);return e},d=(e,r)=>H(e,W(r));import{r as m,a as u,c as D,p as h,j as E,F as v}from"./index.efbe83c6.js";import{I as J}from"./Input.e766bb10.js";import{R as K}from"./RadioGroup.5cc8d871.js";import{a as Q}from"./Group.8ff3ffe7.js";import{S as U}from"./Option.af61b9b8.js";import{S as X}from"./Switch.c75c0757.js";import{T as Y}from"./Textarea.1a014448.js";import{D as ee}from"./DatePicker.e4f5523f.js";import{F as te,a as re}from"./contextForm.e282e2fd.js";import{d as ae}from"./index.4eedf3c9.js";const P=m.exports.forwardRef((e,r)=>{var F;let t=u("div",{});const a=e.defaultValue||((F=e.data)==null?void 0:F.defaultValue),n=m.exports.useRef(a),c=C=>{n.current=C,e.onChange&&e.onChange(C)};switch(e.type){case"radio":t=u(K,d(f({},e.data),{defaultValue:a,onChange:c}));break;case"checkbox":t=u(Q,d(f({},e.data),{defaultValue:a,onChange:c}));break;case"select":t=u(U,d(f({},e.data),{defaultValue:a,onChange:c}));break;case"switch":t=u(X,d(f({},e.data),{defaultValue:a,onChange:c}));break;case"textarea":t=u(Y,d(f({},e.data),{defaultValue:a,onChange:c}));break;case"datePicker":t=u(ee,d(f({},e.data),{defaultValue:a,onChange:c}));break;default:t=u(J,d(f({},e.data),{defaultValue:a,onChange:c}))}const B=()=>n.current;return m.exports.useImperativeHandle(r,()=>({getValue:B})),t});P.displayName="Field";const S={digits:/^[0-9]*[1-9][0-9]*$/,number:/^\d+(\.\d+)?$/,mobile:/^1[3|4|5|7|8]\d{9}$/,mail:/^[a-z0-9A-Z._%-]+@([a-z0-9A-Z-]+\.)+[a-zA-Z]{2,4}$/,tel:/^0\d{2,3}-\d{7,8}$/,fax:/^(\d{3,4})?[-]?\d{7,8}$/};function T(e){const r=Function;return new r("return "+e)()}const b=function(e){return/^\s*$/g.test(e)},y=function(e,r,t){return t==="rule"?T(r).test(e):S[r]===void 0?"undefined":T(S[r]).test(e)},ne=function(e,r){for(let t=0,a=r.length;t<a;t++){const n=r[t];switch(n.type){case"required":if(b(e)||e===!1||e===void 0)return n.msg;break;case"digits":case"number":case"mobile":case"mail":case"tel":case"fax":if(!b(e)&&!y(e,n.type))return n.msg;break;case"phone":if(!b(e)&&!(y(e,"mobile")||y(e,"tel")))return n.msg;break;case"maxLength":if(!b(e)&&parseInt(e.length,10)>parseInt(n.len,10))return n.msg;break;case"minLength":if(!b(e)&&parseInt(e.length,10)<parseInt(n.len,10))return n.msg;break;case"rule":if(!b(e)&&!y(e,n.rule,"rule"))return n.msg;break;case"fn":if(!n.validator(e))return n.msg;break}}return!0},p=m.exports.forwardRef((e,r)=>{const t=m.exports.useRef(),a=m.exports.useContext(te),n=(i,l)=>{const s=e[i];return s===l&&Object.keys(a).length>0?a[i]:s},c=n("size",void 0),B=n("labelWidth",void 0),F=n("trigger","change"),C=n("showMessage",!0),[g,V]=m.exports.useState({msg:"",icon:""}),z={display:e.labelVisible?"none":"",width:B},I=[];if(e.verify){const i={required:"\u5FC5\u586B\u5B57\u6BB5",mobile:"\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E",tel:"\u7535\u8BDD\u53F7\u7801\u4E0D\u6B63\u786E",mail:"\u8BF7\u8F93\u5165\u6B63\u786E\u90AE\u7BB1",digits:"\u5FC5\u987B\u4E3A\u6B63\u6574\u6570",number:"\u5FC5\u987B\u4E3A\u6570\u5B57",phone:"\u8BF7\u8F93\u5165\u56FA\u8BDD\u6216\u624B\u673A"};e.verify.split(",").forEach(s=>{I.push({type:s,msg:i[s]})})}let o=(e.rules||[]).concat(I);(o==null?void 0:o.length)===0&&e.prop&&(a==null?void 0:a.rules)&&(o=a.rules[e.prop]||[]);const j=(()=>{let i=!1;return n("required",!0)&&(o==null?void 0:o.length)>0&&o.forEach(s=>{if(s.type==="required")return i=!0,!1}),i})(),k=i=>{const l=i===void 0?t.current:i;let s={msg:"",icon:""};return new Promise((x,$)=>{if(e.error)$(e.error);else if(o.length>0){const w=ne(l,o);w===!0?(s={msg:"",icon:"icon-success"},x(!0)):(s={msg:w,icon:"icon-failure"},$(w))}else x(!0),console.log("\u6CA1\u6709\u6821\u9A8C\u89C4\u5219\u901A\u8FC7"+e.prop);V(s)})},R=()=>t.current,q=()=>{V({icon:"",msg:""})};m.exports.useImperativeHandle(r,()=>({getValue:R,clearTips:q,validate:k}));const L=ae(()=>{!e.prop||a.callback&&a.callback({validate:k,clearTips:q,getValue:R,prop:e.prop||""})});m.exports.useEffect(()=>{L()},[]);const M={disabled:a.disabled,controlChange:(i,l)=>{if(t.current=i,l!=="default")if(l==="focus"){let s="";o.forEach(x=>{x.type==="tips"&&(s=x.msg)}),s&&!i&&V({msg:s,icon:"icon-tips"})}else l==="blur"?F&&k(i).catch(s=>{console.log(s)}):l==="change"&&(F==="change"&&k(i).catch(s=>{console.log(s)}),e.onChange&&e.onChange(i),a.onChange&&a.onChange(i,e.prop||""))}},Z=u("label",{className:D({required:j,[h+"-form-label"]:!0}),style:z,children:e.label});return u(re.Provider,{value:M,children:E("div",{className:D(e.className,{[h+"-form-item-error"]:g.msg!=="",[h+"-form-item"]:!0,["form-item-"+c]:c}),children:[e.label?Z:"",E("div",{className:`${h}-form-box`,children:[e.type?u(P,{type:e.type,data:e.data,defaultValue:e.defaultValue}):"",e.children,u(v,{children:g.icon&&C&&((o==null?void 0:o.length)>0||e.error)?g.msg?E("div",{className:`${h}-form-tips`,children:[u("i",{className:g.icon}),u("span",{children:g.msg})]}):u("div",{className:`${h}-form-tips ${g.icon}`}):""})]}),e.other]})})});p.displayName="FormItem";p.defaultProps={required:!0,showMessage:!0,trigger:"change",rules:[]};export{p as F,P as a};
