var j=Object.defineProperty,q=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var I=(e,s,l)=>s in e?j(e,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[s]=l,N=(e,s)=>{for(var l in s||(s={}))G.call(s,l)&&I(e,l,s[l]);if(T)for(var l of T(s))J.call(s,l)&&I(e,l,s[l]);return e},k=(e,s)=>q(e,z(s));import{r as o,a as g,j as M,p as Q,c as W,R as X}from"./index.b63450ce.js";import{S as Y}from"./SelectDown.0159d0e9.js";import{d as w,o as V}from"./index.4eedf3c9.js";import{a as Z}from"./contextForm.5487fa67.js";const D=o.exports.forwardRef((e,s)=>{const{optionsKey:l={label:"label",value:"value"}}=e,[f,m]=o.exports.useState([]),[r,d]=o.exports.useState([]),[i,C]=o.exports.useState(e.options||[]),[S,E]=o.exports.useState([]),b=o.exports.useRef(""),x=o.exports.useRef(null),O=o.exports.useContext(Z);o.exports.useEffect(()=>{C([...e.options||[]])},[e.defaultValue,e.options]),o.exports.useEffect(()=>{B()},[i,e.defaultValue]),o.exports.useEffect(()=>{R()},[e.children]);const R=w(()=>{const t=[],a=e.children;a&&typeof a=="object"&&(a.forEach(n=>{X.isValidElement(n)&&typeof n.type=="function"&&n.type.name==="Options"&&t.push(n.props)}),C([...i,...t]))}),B=w(()=>{const t=e.multiple?e.defaultValue||[]:e.defaultValue||"";if((t==null?void 0:t.length)>0&&(i==null?void 0:i.length)>0){let a=[];e.multiple?a=[...e.defaultValue]:a=[e.defaultValue];for(let n=0;n<i.length;n++){const u=i[n][l.value],c=i[n][l.label];if(e.multiple){if(typeof t=="object"){const h=t.indexOf(u);h!==-1&&a.splice(h,1,c)}}else if(u===t){a[0]=c;break}}d([...a])}m(typeof t=="object"?[...t]:[t])},10),H=t=>{const a=t[l.value];return f.includes(a)},L=()=>{var t;(t=x.current)==null||t.slideUp()},P=(t,a)=>{if(!t.disabled){if(e.beforeChange&&!e.beforeChange(t)){L(),a.stopPropagation();return}const n=t[l.value],u=t[l.label];let c=[];if(e.multiple){if(e.multipleLimit&&e.multipleLimit>0&&e.multipleLimit<=r.length)return e.limitChange&&e.limitChange(),!1;let h=[],v=[];f.includes(n)?(h=V(f,[n]),v=V(r,[u])):(h=[...f,n],v=[...r,u]),m(h),d(v),c=h}else L(),m([t[l.value]]),d([t[l.label]]),c=t[l.value];e.onChange&&e.onChange(c),O.controlChange&&O.controlChange(c,"change")}a.stopPropagation()},p=(t,a,n)=>{!e.filterable||(b.current=t,e.onBlur&&e.onBlur(t,a,n))},F=t=>{if(!t&&e.filterable&&b.current){let a=!1;for(let n=0;n<i.length;n++){const u=i[n][l.label],c=i[n][l.value];if(b.current===u){e.multiple?(d([...r,u]),m([...f,c]),y()):(d([u]),m([c])),a=!0;break}}a||(e.multiple?y():d([...r])),E([])}},K=(t,a,n)=>{if(!e.async){const u=[];i.forEach(c=>{c[l.label].indexOf(t)===-1&&u.push(c[l.value])}),E([...u])}e.onInput&&e.onInput(t,a,n)},U=t=>{!e.multiple||(f.splice(t,1),r.splice(t,1),m([...f]),d([...r]),e.onDelete&&e.onDelete(t))},A=()=>e.multiple?f:f[0],y=()=>{var t;(t=x.current)==null||t.clearValue()};o.exports.useImperativeHandle(s,()=>({getValue:A,clearValue:y}));const $=V(e,["options","multipleLimit","optionsKey","beforeChange","async","emptyText"]);return g(Y,k(N({},$),{defaultValue:r,onBlur:p,onInput:K,onDelete:U,toggleClick:F,ref:x,children:M("ul",{className:`${Q}-select`,children:[i.map((t,a)=>g("li",{className:W({disabled:t.disabled,[t.class]:t.class,active:H(t)}),title:t[l.label],onClick:P.bind(globalThis,t),style:{display:S.includes(t[l.value])?"none":""},children:t[l.label]},a)),i.length===0||i.length===S.length?g("li",{className:"select-empty-options",children:e.emptyText||"\u6682\u65E0\u6570\u636E"}):""]})}))});D.displayName="Select";D.propTypes={};const _=e=>g("div",{});_.displayName="Options";export{_ as O,D as S};
