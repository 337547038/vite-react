import{r as u,j as h,p as U,c as A,R as $}from"./index-eab8b3d4.js";import{S as q}from"./SelectDown-93100f6a.js";import{d as L,o as v}from"./index-a427ff8b.js";import{a as z}from"./contextForm-cfeffa56.js";const I=u.forwardRef((t,T)=>{const{optionsKey:a={label:"label",value:"value"}}=t,[o,f]=u.useState([]),[r,m]=u.useState([]),[i,y]=u.useState(t.options||[]),[V,S]=u.useState([]),g=u.useRef(""),b=u.useRef(null),E=u.useContext(z);u.useEffect(()=>{y([...t.options||[]])},[t.defaultValue,t.options]),u.useEffect(()=>{R()},[i,t.defaultValue]),u.useEffect(()=>{N()},[t.children]);const N=L(()=>{const e=[],l=t.children;l&&typeof l=="object"&&(l.forEach(n=>{$.isValidElement(n)&&typeof n.type=="function"&&n.type.name==="Options"&&e.push(n.props)}),y([...i,...e]))}),R=L(()=>{const e=t.multiple?t.defaultValue||[]:t.defaultValue||"";if((e==null?void 0:e.length)>0&&(i==null?void 0:i.length)>0){let l=[];t.multiple?l=[...t.defaultValue]:l=[t.defaultValue];for(let n=0;n<i.length;n++){const s=i[n][a.value],c=i[n][a.label];if(t.multiple){if(typeof e=="object"){const d=e.indexOf(s);d!==-1&&l.splice(d,1,c)}}else if(s===e){l[0]=c;break}}m([...l])}f(typeof e=="object"?[...e]:[e])},10),k=e=>{const l=e[a.value];return o.includes(l)},O=()=>{var e;(e=b.current)==null||e.slideUp()},w=(e,l)=>{if(!e.disabled){if(t.beforeChange&&!t.beforeChange(e)){O(),l.stopPropagation();return}const n=e[a.value],s=e[a.label];let c=[];if(t.multiple){if(t.multipleLimit&&t.multipleLimit>0&&t.multipleLimit<=r.length)return t.limitChange&&t.limitChange(),!1;let d=[],C=[];o.includes(n)?(d=v(o,[n]),C=v(r,[s])):(d=[...o,n],C=[...r,s]),f(d),m(C),c=d}else O(),f([e[a.value]]),m([e[a.label]]),c=e[a.value];t.onChange&&t.onChange(c),E.controlChange&&E.controlChange(c,"change")}l.stopPropagation()},D=(e,l,n)=>{t.filterable&&(g.current=e,t.onBlur&&t.onBlur(e,l,n))},j=e=>{if(!e&&t.filterable&&g.current){let l=!1;for(let n=0;n<i.length;n++){const s=i[n][a.label],c=i[n][a.value];if(g.current===s){t.multiple?(m([...r,s]),f([...o,c]),x()):(m([s]),f([c])),l=!0;break}}l||(t.multiple?x():m([...r])),S([])}},B=(e,l,n)=>{if(!t.async){const s=[];i.forEach(c=>{c[a.label].indexOf(e)===-1&&s.push(c[a.value])}),S([...s])}t.onInput&&t.onInput(e,l,n)},H=e=>{t.multiple&&(o.splice(e,1),r.splice(e,1),f([...o]),m([...r]),t.onDelete&&t.onDelete(e))},P=()=>t.multiple?o:o[0],x=()=>{var e;(e=b.current)==null||e.clearValue()},F=()=>{f([]),m([]),t.onChange&&t.onChange("")};u.useImperativeHandle(T,()=>({getValue:P,clearValue:x}));const K=v(t,["options","multipleLimit","optionsKey","beforeChange","async","emptyText"]);return h.jsx(q,{...K,defaultValue:r,onBlur:D,onInput:B,onDelete:H,toggleClick:j,onClear:F,ref:b,children:h.jsxs("ul",{className:`${U}-select`,children:[i.map((e,l)=>h.jsx("li",{className:A({disabled:e.disabled,[e.class]:e.class,active:k(e)}),title:e[a.label],onClick:w.bind(void 0,e),style:{display:V.includes(e[a.value])?"none":""},children:e[a.label]},l)),i.length===0||i.length===V.length?h.jsx("li",{className:"select-empty-options",children:t.emptyText||"暂无数据"}):""]})})});I.displayName="Select";I.propTypes={};const G=t=>h.jsx("div",{});G.displayName="Options";export{G as O,I as S};
