var z=Object.defineProperty,G=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var I=(e,s,l)=>s in e?z(e,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[s]=l,N=(e,s)=>{for(var l in s||(s={}))M.call(s,l)&&I(e,l,s[l]);if(T)for(var l of T(s))Q.call(s,l)&&I(e,l,s[l]);return e},k=(e,s)=>G(e,J(s));import{r as o,a as g,j as W,p as X,c as Y,R as Z}from"./index.efbe83c6.js";import{S as _}from"./SelectDown.51522df4.js";import{d as w,o as v}from"./index.4eedf3c9.js";import{a as p}from"./contextForm.e282e2fd.js";const D=o.exports.forwardRef((e,s)=>{const{optionsKey:l={label:"label",value:"value"}}=e,[f,r]=o.exports.useState([]),[h,m]=o.exports.useState([]),[i,V]=o.exports.useState(e.options||[]),[S,E]=o.exports.useState([]),b=o.exports.useRef(""),x=o.exports.useRef(null),O=o.exports.useContext(p);o.exports.useEffect(()=>{V([...e.options||[]])},[e.defaultValue,e.options]),o.exports.useEffect(()=>{B()},[i,e.defaultValue]),o.exports.useEffect(()=>{R()},[e.children]);const R=w(()=>{const t=[],a=e.children;a&&typeof a=="object"&&(a.forEach(n=>{Z.isValidElement(n)&&typeof n.type=="function"&&n.type.name==="Options"&&t.push(n.props)}),V([...i,...t]))}),B=w(()=>{const t=e.multiple?e.defaultValue||[]:e.defaultValue||"";if((t==null?void 0:t.length)>0&&(i==null?void 0:i.length)>0){let a=[];e.multiple?a=[...e.defaultValue]:a=[e.defaultValue];for(let n=0;n<i.length;n++){const u=i[n][l.value],c=i[n][l.label];if(e.multiple){if(typeof t=="object"){const d=t.indexOf(u);d!==-1&&a.splice(d,1,c)}}else if(u===t){a[0]=c;break}}m([...a])}r(typeof t=="object"?[...t]:[t])},10),H=t=>{const a=t[l.value];return f.includes(a)},L=()=>{var t;(t=x.current)==null||t.slideUp()},P=(t,a)=>{if(!t.disabled){if(e.beforeChange&&!e.beforeChange(t)){L(),a.stopPropagation();return}const n=t[l.value],u=t[l.label];let c=[];if(e.multiple){if(e.multipleLimit&&e.multipleLimit>0&&e.multipleLimit<=h.length)return e.limitChange&&e.limitChange(),!1;let d=[],y=[];f.includes(n)?(d=v(f,[n]),y=v(h,[u])):(d=[...f,n],y=[...h,u]),r(d),m(y),c=d}else L(),r([t[l.value]]),m([t[l.label]]),c=t[l.value];e.onChange&&e.onChange(c),O.controlChange&&O.controlChange(c,"change")}a.stopPropagation()},F=(t,a,n)=>{!e.filterable||(b.current=t,e.onBlur&&e.onBlur(t,a,n))},K=t=>{if(!t&&e.filterable&&b.current){let a=!1;for(let n=0;n<i.length;n++){const u=i[n][l.label],c=i[n][l.value];if(b.current===u){e.multiple?(m([...h,u]),r([...f,c]),C()):(m([u]),r([c])),a=!0;break}}a||(e.multiple?C():m([...h])),E([])}},U=(t,a,n)=>{if(!e.async){const u=[];i.forEach(c=>{c[l.label].indexOf(t)===-1&&u.push(c[l.value])}),E([...u])}e.onInput&&e.onInput(t,a,n)},A=t=>{!e.multiple||(f.splice(t,1),h.splice(t,1),r([...f]),m([...h]),e.onDelete&&e.onDelete(t))},$=()=>e.multiple?f:f[0],C=()=>{var t;(t=x.current)==null||t.clearValue()},j=()=>{r([]),m([]),e.onChange&&e.onChange("")};o.exports.useImperativeHandle(s,()=>({getValue:$,clearValue:C}));const q=v(e,["options","multipleLimit","optionsKey","beforeChange","async","emptyText"]);return g(_,k(N({},q),{defaultValue:h,onBlur:F,onInput:U,onDelete:A,toggleClick:K,onClear:j,ref:x,children:W("ul",{className:`${X}-select`,children:[i.map((t,a)=>g("li",{className:Y({disabled:t.disabled,[t.class]:t.class,active:H(t)}),title:t[l.label],onClick:P.bind(globalThis,t),style:{display:S.includes(t[l.value])?"none":""},children:t[l.label]},a)),i.length===0||i.length===S.length?g("li",{className:"select-empty-options",children:e.emptyText||"\u6682\u65E0\u6570\u636E"}):""]})}))});D.displayName="Select";D.propTypes={};const ee=e=>g("div",{});ee.displayName="Options";export{ee as O,D as S};
